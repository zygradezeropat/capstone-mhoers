<div class="modal fade" id="editPatients" tabindex="-1" role="dialog" aria-labelledby="editPatientsLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content shadow-lg border-0">
            <!-- Modal Header -->
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="editPatientsLabel">
                    <i class="bi bi-pencil-square me-2"></i>Edit Patient Information
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div> 

            <!-- Modal Body -->
            <div class="modal-body p-4">
                <form action="{% url 'patients:editPatient' %}" method="POST" id="editPatientForm" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <input type="hidden" name="patient_id" id="edit-patient-id">
                    
                    <!-- Basic Information -->
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="editFname" class="fw-semibold">First Name</label>
                            <input type="text" class="form-control rounded-pill" id="editFname" name="editFname" required placeholder="Enter first name">
                        </div>
                        <div class="col-md-4">
                            <label for="editMname" class="fw-semibold">Middle Name</label>
                            <input type="text" class="form-control rounded-pill" id="editMname" name="editMname" placeholder="Enter middle name">
                        </div>
                        <div class="col-md-4">
                            <label for="editLname" class="fw-semibold">Last Name</label>
                            <input type="text" class="form-control rounded-pill" id="editLname" name="editLname" required placeholder="Enter last name">
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-md-6">
                            <label for="editAddress" class="fw-semibold">Address</label>
                            <select class="form-control rounded-pill" id="editAddress" name="editAddress" required>
                                <option value="">Select Address</option>
                                
                                <!-- New Cortez Barangay -->
                                <optgroup label="New Cortez">
                                    <option value="Prk 1, Central, New Cortez, New Corella, Davao del Norte">Prk 1, Central, New Cortez, New Corella, Davao del Norte</option>
                                    <option value="Prk 2, Matin Ao, New Cortez, New Corella, Davao del Norte">Prk 2, Matin Ao, New Cortez, New Corella, Davao del Norte</option>
                                    <option value="Prk 3, Kauswagan, New Cortez, New Corella, Davao del Norte">Prk 3, Kauswagan, New Cortez, New Corella, Davao del Norte</option>
                                    <option value="Prk 4, Anaman, New Cortez, New Corella, Davao del Norte">Prk 4, Anaman, New Cortez, New Corella, Davao del Norte</option>
                                    <option value="Prk 5, Kasilak, New Cortez, New Corella, Davao del Norte">Prk 5, Kasilak, New Cortez, New Corella, Davao del Norte</option>
                                    <option value="Prk 6, San Roque, New Cortez, New Corella, Davao del Norte">Prk 6, San Roque, New Cortez, New Corella, Davao del Norte</option>
                                </optgroup>
                                
                                <!-- Carcor Barangay -->
                                <optgroup label="Carcor">
                                    <option value="Prk 1, Carcor, New Corella, Davao del Norte">Prk 1, Carcor, New Corella, Davao del Norte</option>
                                    <option value="Prk 2, Carcor, New Corella, Davao del Norte">Prk 2, Carcor, New Corella, Davao del Norte</option>
                                    <option value="Prk 3, Carcor, New Corella, Davao del Norte">Prk 3, Carcor, New Corella, Davao del Norte</option>
                                </optgroup>
                                
                                <!-- Mesaoy Barangay -->
                                <optgroup label="Mesaoy">
                                    <option value="Prk 1, Mesaoy, New Corella, Davao del Norte">Prk 1, Mesaoy, New Corella, Davao del Norte</option>
                                    <option value="Prk 2, Mesaoy, New Corella, Davao del Norte">Prk 2, Mesaoy, New Corella, Davao del Norte</option>
                                    <option value="Prk 3, Mesaoy, New Corella, Davao del Norte">Prk 3, Mesaoy, New Corella, Davao del Norte</option>
                                    <option value="Prk 4, Mesaoy, New Corella, Davao del Norte">Prk 4, Mesaoy, New Corella, Davao del Norte</option>
                                </optgroup>
                                
                                <!-- Sta. Cruz Barangay -->
                                <optgroup label="Sta. Cruz">
                                    <option value="Sta. Cruz, New Corella, Davao del Norte">Sta. Cruz, New Corella, Davao del Norte</option>
                                </optgroup>
                                
                                <!-- Other Barangays in New Corella -->
                                <optgroup label="Other Barangays">
                                    <option value="Cabidianan, New Corella, Davao del Norte">Cabidianan, New Corella, Davao del Norte</option>
                                    <option value="Del Monte, New Corella, Davao del Norte">Del Monte, New Corella, Davao del Norte</option>
                                    <option value="Del Pilar, New Corella, Davao del Norte">Del Pilar, New Corella, Davao del Norte</option>
                                    <option value="El Salvador, New Corella, Davao del Norte">El Salvador, New Corella, Davao del Norte</option>
                                    <option value="Limba-an, New Corella, Davao del Norte">Limba-an, New Corella, Davao del Norte</option>
                                    <option value="Macgum, New Corella, Davao del Norte">Macgum, New Corella, Davao del Norte</option>
                                    <option value="Mambing, New Corella, Davao del Norte">Mambing, New Corella, Davao del Norte</option>
                                    <option value="New Bohol, New Corella, Davao del Norte">New Bohol, New Corella, Davao del Norte</option>
                                    <option value="New Sambog, New Corella, Davao del Norte">New Sambog, New Corella, Davao del Norte</option>
                                    <option value="Patrocenio, New Corella, Davao del Norte">Patrocenio, New Corella, Davao del Norte</option>
                                    <option value="Poblacion, New Corella, Davao del Norte">Poblacion, New Corella, Davao del Norte</option>
                                    <option value="San Roque, New Corella, Davao del Norte">San Roque, New Corella, Davao del Norte</option>
                                    <option value="Sta. Fe, New Corella, Davao del Norte">Sta. Fe, New Corella, Davao del Norte</option>
                                    <option value="Sto. Niño, New Corella, Davao del Norte">Sto. Niño, New Corella, Davao del Norte</option>
                                    <option value="Suawon, New Corella, Davao del Norte">Suawon, New Corella, Davao del Norte</option>
                                    <option value="San Jose, New Corella, Davao del Norte">San Jose, New Corella, Davao del Norte</option>
                                </optgroup>
                                
                                <!-- Manual Entry Option -->
                                <optgroup label="Other">
                                    <option value="__manual__">Enter Address Manually</option>
                                </optgroup>
                            </select>
                            
                            <!-- Manual Address Input (hidden by default) -->
                            <input type="text" class="form-control rounded-pill mt-2" id="editAddressManual" placeholder="Enter complete address manually" style="display: none;">
                            
                            <small class="text-muted">Select from dropdown or choose "Enter Address Manually" to type your address</small>
                        </div>
                        <div class="col-md-6">
                            <label for="ePhone" class="fw-semibold">Phone Number</label>
                            <input type="tel" class="form-control rounded-pill" id="ePhone" name="ePhone" pattern="[0-9]{11}" inputmode="numeric" required placeholder="Enter 11-digit phone number">
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-md-6">
                            <label for="editBday" class="fw-semibold">Date of Birth</label>
                            <input type="date" class="form-control rounded-pill" id="editBday" name="editBday" required>
                        </div>
                        <div class="col-md-6">
                            <label for="eSex" class="fw-semibold">Sex</label>
                            <select class="form-control rounded-pill" id="eSex" name="eSex" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <hr class="my-3">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-info-circle me-2"></i>Additional Information
                            </h6>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-md-6">
                            <label for="editCivilStatus" class="fw-semibold">Civil Status</label>
                            <select class="form-control rounded-pill" id="editCivilStatus" name="editCivilStatus">
                                <option value="">Select Civil Status</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Widowed">Widowed</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Separated">Separated</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="editPhicStatus" class="fw-semibold">PHIC Status</label>
                            <select class="form-control rounded-pill" id="editPhicStatus" name="editPhicStatus">
                                <option value="">Select PHIC Status</option>
                                <option value="M">Member</option>
                                <option value="D">Dependent</option>
                            </select>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="editCctBeneficiary" name="editCctBeneficiary">
                                <label class="form-check-label fw-semibold" for="editCctBeneficiary">
                                    <i class="bi bi-check-circle me-2"></i>CCT Beneficiary
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="editIsPwd" name="editIsPwd">
                                <label class="form-check-label fw-semibold" for="editIsPwd">
                                    <i class="bi bi-person-wheelchair me-2"></i>Person With Disability (PWD)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- PhilHealth Information Section -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editIsPhilhealthMember" name="editIsPhilhealthMember" onchange="toggleEditPhilHealthFields()">
                                <label class="form-check-label fw-semibold" for="editIsPhilhealthMember">
                                    <i class="bi bi-card-checklist me-2"></i>PhilHealth Member
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-1" id="editPhilhealthFields" style="display: none;">
                        <div class="col-md-6">
                            <label for="editPhilhealthNumber" class="fw-semibold mb-2 d-block">PhilHealth Number</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                                <input type="text" class="form-control rounded-pill" id="editPhilhealthNumber" name="editPhilhealthNumber" placeholder="Enter PhilHealth number">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="editPhilhealthCategory" class="fw-semibold mb-2 d-block">PhilHealth Category</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-tag"></i></span>
                                <select class="form-control rounded-pill" id="editPhilhealthCategory" name="editPhilhealthCategory">
                                    <option value="">Select Category</option>
                                    <option value="Sponsored">Sponsored</option>
                                    <option value="Self Paying">Self Paying</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Family History Section -->
                    <div class="row g-3 mt-3">
                        <div class="col-12">
                            <hr class="my-3">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-diagram-3-fill me-2"></i>Family History
                            </h6>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFamilyHistoryHypertension" name="editFamilyHistoryHypertension">
                                <label class="form-check-label fw-semibold" for="editFamilyHistoryHypertension">
                                    <i class="bi bi-heart-pulse me-2"></i>Hypertension
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFamilyHistoryDiabetes" name="editFamilyHistoryDiabetes">
                                <label class="form-check-label fw-semibold" for="editFamilyHistoryDiabetes">
                                    <i class="bi bi-droplet me-2"></i>Diabetes
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFamilyHistoryCancer" name="editFamilyHistoryCancer">
                                <label class="form-check-label fw-semibold" for="editFamilyHistoryCancer">
                                    <i class="bi bi-exclamation-triangle me-2"></i>Cancer
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFamilyHistoryAsthma" name="editFamilyHistoryAsthma">
                                <label class="form-check-label fw-semibold" for="editFamilyHistoryAsthma">
                                    <i class="bi bi-wind me-2"></i>Asthma
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFamilyHistoryEpilepsy" name="editFamilyHistoryEpilepsy">
                                <label class="form-check-label fw-semibold" for="editFamilyHistoryEpilepsy">
                                    <i class="bi bi-lightning me-2"></i>Epilepsy
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editFamilyHistoryTuberculosis" name="editFamilyHistoryTuberculosis">
                                <label class="form-check-label fw-semibold" for="editFamilyHistoryTuberculosis">
                                    <i class="bi bi-lungs me-2"></i>Tuberculosis
                                </label>
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="editFamilyHistoryOthers" class="fw-semibold">Others (Please specify)</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-list-ul"></i></span>
                                <textarea class="form-control" id="editFamilyHistoryOthers" name="editFamilyHistoryOthers" rows="3" placeholder="Enter other family history..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer bg-light mt-4">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-2"></i>Cancel
                        </button>
                        <button type="submit" class="btn btn-warning text-dark">
                            <i class="bi bi-check-circle me-2"></i>Update
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
  // Function to toggle PhilHealth fields in edit modal
  function toggleEditPhilHealthFields() {
    const checkbox = document.getElementById('editIsPhilhealthMember');
    const fieldsContainer = document.getElementById('editPhilhealthFields');
    const numberField = document.getElementById('editPhilhealthNumber');
    const categoryField = document.getElementById('editPhilhealthCategory');
    
    if (checkbox && fieldsContainer && numberField && categoryField) {
      if (checkbox.checked) {
        fieldsContainer.style.display = '';
        fieldsContainer.classList.remove('d-none');
        fieldsContainer.classList.add('d-block');
        numberField.required = true;
        categoryField.required = true;
      } else {
        fieldsContainer.style.display = 'none';
        fieldsContainer.classList.add('d-none');
        fieldsContainer.classList.remove('d-block');
        numberField.required = false;
        categoryField.required = false;
        numberField.value = '';
        categoryField.value = '';
      }
    }
  }

  // Handle manual address entry in edit modal
  $(document).ready(function() {
    $('#editAddress').on('change', function() {
      if ($(this).val() === '__manual__') {
        $('#editAddressManual').show().prop('required', true).attr('name', 'editAddress');
        $(this).removeAttr('name').removeAttr('required');
        setTimeout(function() {
          $('#editAddressManual').focus();
        }, 100);
      } else if ($(this).val() !== '' && $(this).val() !== '__manual__') {
        $('#editAddressManual').hide().removeAttr('name').prop('required', false).val('');
        $(this).attr('name', 'editAddress').prop('required', true);
      }
    });
  });
</script>
