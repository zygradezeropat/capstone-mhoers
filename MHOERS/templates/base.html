{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}NCERS{% endblock %}</title>
    <link rel="icon" type="image/png" href="{% static 'images/MHO-LOGO.png' %}" />

    <!-- Bootstrap 5.3.2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

    <!-- Custom Styles AFTER Bootstrap -->
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}?v=3" />
    <link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}?v=2" />

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <!-- Mapbox & Leaflet (optional) -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Responsive Layout Styles -->
    <style>
      .main-content {
        margin-left: 280px;
        padding: 20px;
        min-height: 100vh;
        transition: margin-left 0.3s ease;
        background: #f8f9fa;
      }
      
      /* Collapsed sidebar main content adjustment */
      .main-content.sidebar-collapsed {
        margin-left: 70px;
      }
      
      @media (max-width: 1199px) and (min-width: 768px) {
        .main-content {
          margin-left: 260px;
        }
        
        .main-content.sidebar-collapsed {
          margin-left: 70px;
        }
      }
      
      @media (max-width: 767px) {
        .main-content {
          margin-left: 0;
          padding: 15px;
          padding-top: 80px; /* Space for toggle button */
        }
        
        .main-content.sidebar-collapsed {
          margin-left: 0;
        }
      }
      
      @media (max-width: 480px) {
        .main-content {
          padding: 10px;
          padding-top: 70px;
        }
        
        .main-content.sidebar-collapsed {
          margin-left: 0;
        }
      }
    </style>
    
    <!-- Modal z-index fixes -->
    <style>
      /* Ensure modals appear above sidebar */
      .modal {
        z-index: 1050 !important;
      }
      
      .modal-backdrop {
        z-index: 1040 !important;
      }
      
      /* Bootstrap modal z-index override */
      .modal.fade .modal-dialog {
        z-index: 1055 !important;
      }
      
      /* Additional modal z-index for Bootstrap 4 */
      .modal.show {
        z-index: 1050 !important;
      }
      
      .modal-dialog {
        z-index: 1055 !important;
      }
    </style>
  </head>

  <body>
    {% block sidebar %}
      {% if user.is_staff %}
        {% include 'components/admin_sidebar.html' %}
      {% else %}
        {% include 'components/sidebar.html' %}
      {% endif %}
    {% endblock %}

    <main class="main-content">
      {% block content %}{% endblock %}
      {% block alerts %}
        {% if messages %}
          <div class="alert alert-success">
            {% for message in messages %}
              <p>{{ message }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-light border-top mt-auto py-3" style="margin-left: 280px;">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12 text-center">
            <small class="text-muted">
              &copy; {% now "Y" %} MHOERS - Municipal Health Office Electronic Referral System | 
              <a href="{% url 'privacy_policy' %}" class="text-decoration-none">Privacy Policy</a>
              {% if user.is_authenticated %}
                | <a href="{% url 'request_deletion' %}" class="text-decoration-none">Request Data Deletion</a>
              {% endif %}
            </small>
          </div>
        </div>
      </div>
    </footer>

    <!-- jQuery and Bootstrap 5 Bundle (Popper + Bootstrap JS) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Sidebar Script -->
    <script src="{% static 'js/sidebar.js' %}"></script>
  </body>
</html>
