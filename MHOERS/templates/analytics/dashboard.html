{% extends 'base.html' %}

{% load static %}  <!-- Load static tag -->

{% block content %} 

<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

<!-- Navbar Include -->
{% include 'components/navbar.html' %}

<!-- Dashboard Cards -->
<div class="container mt-4">
  <div class="row mt-4">
    <div class="col-md-4">
      <div class="card-counter primary">
        <i class="fa fa-code-fork"></i>
        <span class="count-numbers">{{ total_patients }}</span>
        <span class="count-name">Total Patients</span>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card-counter success">
        <i class="fa fa-database"></i>
        <span class="count-numbers">{{ active_referrals }}</span>
        <span class="count-name">Ongoing Referral</span>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card-counter info">
        <i class="fa fa-users"></i>
        <span class="count-numbers">{{ completed_referrals }}</span>
        <span class="count-name">Total Referred</span>
      </div>
    </div>
  </div>


  
  <!-- Schedule today content -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <div class="reminder-main">
            <div class="reminder-header text-muted ">
              <h4 class="fw-bold">Today Schedules</h4>
            </div>
            <div id="scheduleContent"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Calendar Section -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <div class="calendar-main">
            <div class="calendar-header">
              <h2 id="currentMonth"></h2>
              <div class="calendar-nav">
                <button class="btn btn-secondary" onclick="previousMonth()">Previous</button>
                <button class="btn btn-primary" onclick="goToToday()">Today</button>
                <button class="btn btn-secondary" onclick="nextMonth()">Next</button>
              </div>
            </div>
            <div class="calendar-grid" id="calendarGrid">
              <!-- Calendar will be generated here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Map JS -->
<script src="{% static 'js/map.js' %}"></script>

<!-- Bootstrap is loaded in base.html -->
<script src="{% static 'js/line_chart.js' %}"></script>

<!-- Pass current user context to JavaScript -->
<script>
  // Make current user ID and admin status available to calendar.js
  window.currentUserId = {{ request.user.id }};
  window.isAdmin = {{ request.user.is_staff|yesno:"true,false" }};
</script>

<script src="{% static 'js/calendar.js' %}"></script>

{% endblock %}
