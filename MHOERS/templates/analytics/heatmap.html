{% extends 'base.html' %} {% load static %} {% block content %}

<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}" />
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
/>

<!-- Navbar Include -->
{% include 'components/navbar.html' %}

<!-- Disease Heat Map Section -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
        <h4 class="text-primary mb-0">New Corella Disease Heat Map</h4>

        <!-- Disease Filter -->
        <div class="disease-filter">
          <h6 class="mb-3">Filter by Disease:</h6>
          <div class="d-flex flex-wrap">
            <span class="disease-badge open-wounds active" data-disease="open_wounds"
              >Open Wounds (T14.1)</span
            >
            <span class="disease-badge dog-bites" data-disease="dog_bites"
              >Dog Bites (W54.99)</span
            >
            <span
              class="disease-badge acute-respiratory"
              data-disease="acute_respiratory"
              >Acute respiratory infections (J06.9)</span
            >
            <span class="disease-badge pneumonia" data-disease="pneumonia"
              >Pneumonia (J15)</span>
            <span class="disease-badge hypertension-level-2" data-disease="hypertension_level_2"
              >Hypertension Level 2 (I10-1)</span>
              
        </div>
        <div class="disease-filter">
          <h6 class="mb-3">Prediction Month:</h6>
          <div class="d-flex flex-wrap" id="month-container">
            <!-- Month badges will be dynamically generated here -->
          </div>
        </div>

        <div id="map" style="height: 400px"></div>
        
        <!-- Prediction Summary Table -->
        <div id="prediction-table-container" class="mt-4" style="display: none;">
          <h5 class="mb-3">Prediction Summary by Disease and Month</h5>
          <div class="table-responsive">
            <table id="prediction-summary-table" class="table table-striped table-bordered table-hover">
              <thead class="table-primary">
                <tr>
                  <th>Disease</th>
                  <!-- Month columns will be dynamically added here -->
                </tr>
              </thead>
              <tbody>
                <!-- Rows will be dynamically added here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% block script %}
<script src="{% static 'js/line_chart.js' %}"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
<script src="{% static 'js/heatdisease_map.js' %}"></script>

<!-- Pass current user context to JavaScript via data attributes -->
<div id="js-context"
     data-current-user-id="{{ request.user.id }}"
     hidden></div>

<script src="{% static 'js/calendar.js' %}"></script>

<script>
  // Notification check function
  function checkNotifications() {
    fetch("/notifications/check/")
      .then((response) => response.json())
      .then((data) => {
        const notifBadge = document.getElementById("notif-count");
        if (data.unseen_count > 0) {
          notifBadge.innerText = data.unseen_count;
          notifBadge.style.display = "inline";
        } else {
          notifBadge.style.display = "none";
        }
      });
  }

  setInterval(checkNotifications, 5000); // Check every 5 seconds
  window.onload = checkNotifications;
</script>
{% endblock script %} {% endblock %}
